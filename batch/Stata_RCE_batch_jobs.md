**Instruction for running a Stata batch job on the RCE**

There are two modes of running a Stata batch job on the RCE:
interactively and by submitting a script. Jobs are submitted by
executing commands in the terminal window.

***Please, note that you have to submit all condor requests from your
HOME FOLDER, not the `shared_space`.***

**Interactive submission**

The steps for submitting a batch job are the following:

1\. Create the do-file you wish to execute in batch mode the way you
normally do on the RCE.

2\. From within the terminal window, navigate to the folder where your
do-file is located and execute ***`condor_submit_util`***

3\. At the prompt `Enter executable to submit [/usr/bin/R]` enter
***`stata -mp`***

4\. At the prompt `Enter arguments to /usr/local/bin/stata
[--no-save --vanilla]` enter ***`do`***

5\. At the prompt `Enter input file base [in]` enter the name of your
do-file (e.g. ***`mydofile.do`***)

6\. At the prompt `Enter condor output directory [condor_submit_util]:`
hit enter and answer the following questions with yes

7\. At the prompt `Enter output file base [out]` hit enter

8\. Keep hitting enter (in which case the option in the square brackets
will be used) or enter values according to your preferences.

9\. Finally, when prompted choose whether you would like to be notified
and at the next step enter your email address.

Once executed, the condor utility will create a directory called
**`condor_submit_util`** in which you will find an out, log and error
files generated by the utility. These three files contain records of
your job and could be useful in debugging the submission. Specifically,
the error file would tell you whether there is something wrong with your
**`condor_submit_util** submission whereas the log file will keep a
record of the commands executed by Stata as well as the errors it may
have encountered.

*Example record of a job submitted interactively. The do-file is called
**`Test.do`**:*

    rce-4: jharvard [~/Test]$ condor_submit_util

    Enter executable to submit [/usr/bin/R] stata-mp

    Enter arguments to /usr/local/bin/stata-mp [--no-save --vanilla] do

    Enter input file base [in] Test.do

    Enter condor output directory [condor_submit_util]: <Hit Enter>

    Enter output file base [out] <Hit Enter>**

    Enter log file [log] <Hit Enter>

    Enter error file base [error] <Hit Enter>

    Enter number of iterations [1] <Hit Enter or type in number of iterations>

    Would you like to be notified when your jobs complete? (Enter y or n) [yes]: <Hit Enter>

    Please enter your e-mail address [jharvard@harvard.edu]: <Enter email address>

**Submission of a script**

**Submission of a single do-file**

The steps for submitting a script are as follows:

1\. Create the do-file you wish to execute in batch mode the way you
normally do on the RCE.

2\. Create a submission file for your job. You would need a plain text
file in which each statement starts on a new line and includes the
following attributes:

**Universe =** \< this is the universe in which the submission is executed.
On the RCE, ***`vanilla`*** is the appropriate parameter\>

**Executable =** \< this should include the path and name of the software
package that you would like to run. On the RCE, you can run StataMP by
specifying **`/usr/local/bin/stata-mp`**\>

**Arguments =** \< this is the argument that you would like to pass on to
Stata. The argument **`do`** is the appropriate one in this case\>

**notification =** \<here you would have to indicate whether you would like
to be notified about your job. The default option, here is **`Complete`**
which means that you will be notified when the job terminates\>

**notify\_user =** \<this is the email address to use when condor sends
emails; jharvard@harvard.edu\>

**input =** \<here should specify the name of the do-file that you would
like Stata to execute. If the do-file is not in the directory from which
you will execute the submission script, you would have to include the
path to its location.\>

**output =** \<here you specify the name of condor, NOT Stata, output file\>

**error =** \<here you specify the name of condor error file\>

**Log =** \<here you specify the name of condor log file\>

**Queue** \<specify the number of copies of the job you would like to
place\>

*Example of a submission script for a do-file called **`Test.do`**: *

    Universe = vanilla
     
    Executable = /usr/local/bin/stata-mp
     
    Arguments = do
     
    notification = Complete
     
    notify_user = jharvard@harvard.edu
     
    input = Test.do
     
    output = Test.out
     
    error = Test.err
     
    Log = Test.log
     
    Queue 1

*Example of a submission script for a do-file called **`Test.do`**: *

    Executable = /usr/local/bin/stata-mp
    
    Arguments = -q do Test.do $(Cluster) $(Process)
    
    notification = Complete
    
    notify_user = jharvard@harvard.edu
    
    Queue 10

3\. Ensure that the extension of the submission file created in 2 is
**`.submit`**

4\. Copy the submission file to the directory in which you would like to
execute it.

5\. From within the terminal window, navigate to the folder you have
chosen in step 4 and execute the following line:

***`condor_submit <name of submit file>.submit`***

*For example*, if you have created a submit file called
**`Mysubmit.submit`** in step 4, you would type:

***`condor_submit Mysubmit.submit`***

**Submission of multiple do-files**

While it is possible to submit multiple do-files for execution using the
algorithm above by creating a ‘super’ do-file (i.e. a do-file of
do-files) and including it in the submission script, it is also possible
to amend the submission script so that the different do-files are
executed separately. All that is required is adding another block of
input, output, error, log and Queue statements.

*For example*, the submission script for do files **`Test_1.do`** and
**`Test_2.do`** would be the following:

    Universe = vanilla
     
    Executable = /usr/local/bin/stata-mp
     
    Arguments = do
     
    notification = Complete
     
    notify_user = jharvard@harvard.edu
     
    input = Test_1.do
     
    output = Test_1.out
     
    error = Test_1.err
     
    Log = Test_1.log
     
    Queue 1
     
    input = Test_2.do
     
    output = Test_2.out
     
    error = Test_2.err
     
    Log = Test_2.log
     
    Queue 1

For further information on `condor_submit` script commands, please see
[*http://research.cs.wisc.edu/condor/manual/v6.2/condor\_submit.html*](http://research.cs.wisc.edu/condor/manual/v6.2/condor_submit.html)

**Final note**

It is always a good practice to ensure that you either copy the do files
into the folder from which you will call the condor utility or specify
the correct path to their location.

Also, please take note that the condor utility DOES NOT manage Stata
input or output files; it only passes your do-files to Stata. To load
your data and store the results of your analysis properly, you would
have to specify the correct paths in all relevant do-files.
